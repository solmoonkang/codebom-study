## 🧼 DB 샤딩이란?

---

샤딩은 데이터를 조각내서 분산 저장하는 데이터 처리 기법이다.

자세히 설명하면, 샤딩은 데이터를 샤드라고 하는 작은 청크로 분할 및 여러 DB 서버에 저장하여 한계를 극복한다.

### DB 샤딩이 중요한 이유

애플리케이션이 성장함에 따라 애플리케이션 사용자 수와 저장되는 데이터 양이 갈수록 증가하게 된다.

데이터 볼륨이 커지고 동시에 정보를 읽고 저장하는 사용자가 많아지면 병목 현상이 발생한다.

- 이로 인해 애플리케이션 속도가 느려지고 고객 경험에 영향을 미치게 된다.

이에 대한 솔루션으로, 여러 샤드에 더 작은 데이터 세트를 병렬로 처리하는 DB 샤딩을 사용해 해결할 수 있다.

## 🌮 DB 샤딩의 이점

---

### 응답 시간 개선

대규모 단일 DB에서는 데이터를 검색하는 데 시간이 더 오래 걸리는데,

DBMS는 올바른 데이터를 찾기 위해 여러 행을 검색해야 한다.

그에 비해 데이터 샤드는 DB보다 행 수가 적어서 샤딩된 DB에서는 특정 정보를 검색하거나 쿼리를 실행하는 데 걸리는 시간이 단축된다.

### 전체 서비스 중단 방지

DB를 호스팅하는 컴퓨터에서 장애가 발생하면 DB를 사용하는 애플리케이션에서도 오류가 발생한다.

샤딩은 DB 일부를 다른 컴퓨터에 배포함으로써 이 같은 문제를 방지한다.

컴퓨터 중 하나에서 장애가 발생하더라도 정상 작동하는 다른 샤드를 사용하여 작동할 수 있어 애플리케이션이 중단되지 않는다.

또한 샤딩은 샤드 간 데이터 복제와 함께 사용되는 경우가 많다.

- 즉, 샤드 중 하나를 사용할 수 없게 되더라도 대체 샤드에서 데이터를 액세스하고 복원할 수 있다.

### 효율적인 크기 조정

DB가 확장되면 더 많은 컴퓨터 리소스를 소비하고 결국 스토리지의 최대 용량에 도달하게 된다.

이 경우 DB 샤딩을 사용하여 더 많은 컴퓨팅 리소스를 추가함으로써 DB 확장을 지원할 수 있다.

- 유지 관리를 위해 애플리케이션을 종료하지 않고도 런타임에 새 샤드를 추가할 수 있다.

## 📹 DB 샤딩 동작 과정

---

DB는 열과 행으로 구성된 여러 데이터 세트에 정보를 저장하는데,

샤딩은 단일 데이터 세트를 파티션이나 샤드로 분할한다.

각 샤드에는 노드라고 하는 여러 컴퓨터에서 개별적으로 저장할 수 있는 정보의 고유한 행이 포함되어 있다.

따라서 모든 샤드는 각각 개별 노드에서 실행되지만, 원래 DB의 스키마 또는 설계를 공유한다.

예를 들어, 고객 레코드의 데이터 세트를 포함하는 샤딩되지 않는 DB는 다음과 같다.

| 고객 ID | 이름 | 시/도 |
| --- | --- | --- |
| 1 | John | 캘리포니아 |
| 2 | Jane | 워싱턴 |
| 3 | Paulo | 애리조나 |
| 4 | Wang | 조지아 |

---

샤딩 프로세스는 다음과 같이 테이블의 여러 정보 행을 분리하여 다른 시스템에 저장하는 작업을 한다.

**[ 컴퓨터 A ]**

| 고객 ID | 이름 | 시/도 |
| --- | --- | --- |
| 1 | John | 캘리포니아 |
| 2 | Jane | 워싱턴 |

**[ 컴퓨터 B ]**

| 고객 ID | 이름 | 시/도 |
| --- | --- | --- |
| 3 | Paulo | 애리조나 |
| 4 | Wang | 조지아 |

---

## 🚥 DB 샤딩 종류

---

샤딩 방법은 샤드 키에 여러 규칙을 적용하여 특정 데이터 행을 처리할 올바른 노드를 결정한다.

<aside>
📌 샤드 키는 데이터를 여러 샤드로 분산하기 위해 사용되는 키이다.

</aside>

---

일반적인 샤딩 아키텍처는 다음과 같다.

### 1. 모듈러 샤딩 (Modular Sharding)

모듈러 샤딩은 PK를 모듈러 연산한 결과로 DB를 라우팅하는 방식이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/3d83c8b6-9f83-40fe-b443-9f2602cf03a1/Untitled.png)

---

모듈러 샤딩의 특징은 다음과 같다.

- 레인지 샤딩에 비해 데이터가 균일하게 분산된다.
- 하지만, DB를 추가 증설하는 과정에서 이미지 적재된 데이터의 재정렬이 필요하다.
- 따라서 데이터가 일정 수준에서 예상되는 데이터 성격을 가진 곳에 적용할 때 어울린다.

<aside>
📌 데이터가 늘어남에 따라 샤딩을 추가적으로 해야하는 상황이 자주 생기면 큰 부하가 발생하게 된다.

</aside>

---

데이터가 균일하게 분산된다는 점은 트래픽을 안정적으로 소화하면서 DB 리소스를 최대한 활용할 수 있다.

### 2. 레인지 샤딩 (Range Sharding)

레인지 샤딩은 PK의 범위를 기준으로 DB를 특정하는 방식이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/77c097ce-98f2-478e-ab92-2444e2959872/Untitled.png)

---

레인지 샤딩의 특징은 다음과 같다.

- 모듈러 샤딩에 비해 기본적으로 증설에 재정렬 비용이 들지 않는다.
- 반면, 일부 DB에 데이터가 몰릴 수 있다.

<aside>
📌 레인지 샤딩의 가장 큰 장점은 증설 작업에 드는 비용이 크지 않다는 점이다.
따라서 데이터가 급격히 증가할 여지가 있을 때, 레인지 샤딩을 사용하는 것은 좋은 선택이 될 수 있다.

</aside>

---

하지만, 활성 유저가 몰린 DB로 트래픽이나 데이터량이 몰릴 수 있다.

그러면 몰리는 DB는 분산시키고 트래픽이 저조한 DB는 통합시키는 과정이 필요하다.

- 따라서 적절한 범위 기준을 잡는 것이 중요하다.

### 3. 디렉토리 샤딩 (Directory Sharding)

디렉토리 샤딩은 별도의 조회 테이블을 사용해서 샤딩을 하는 경우이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/2e5bd42f-5ba4-44f0-9d13-c47954ca677e/Untitled.png)

---

디렉토리 샤딩의 특징은 다음과 같다.

- 샤딩에 사용되는 시스템이나 알고리즘을 사용할 수 있다.
- 샤드를 동적으로 추가하는 것도 비교적 쉽다.
- 하지만, 모든 읽기 및 쓰기 쿼리 전에 조회 테이블을 참조해야 하므로 오버헤드가 발생한다.

## ⚠️ DB 샤딩의 문제점

---

샤딩을 구현할 때 직면할 수 있는 문제점으로는 다음과 같다.

### 데이터 핫스팟

데이터 분포가 고르지 않아 일부 샤드가 불균형하게 된다.

예를 들어 A로 시작하는 고객 이름을 포함하는 단일 물리적 샤드는 다른 샤드보다 많은 데이터를 수신한다.

- 따라서 물리적 샤드는 다른 샤드보다 더 많은 컴퓨팅 리소스를 사용한다.

이에 대한 솔루션은 다음과 같다:

- 최적의 샤드 키를 사용하여 데이터를 고르게 분산하여 샤딩에 더 적합한 데이터 세트를 사용한다.

---

### 운영 복잡성

샤딩은 운영의 복잡성을 유발한다.

개발자는 단일 DB를 관리하는 것이 아닌, 여러 DB 노드를 관리해야 하고 정보를 검색할 때 개발자는 여러 샤드를 쿼리하고 정보를 결합해야 한다.

- 따라서 이러한 검색 작업은 분석을 복잡하게 만들 수 있다.

---

### 인프라 비용

물리적 샤드로 추가하는 컴퓨터가 많을수록 인프라 비용이 더 많이 발생한다.

이에 대한 솔루션은 다음과 같다:

- AWS EC2를 사용하여 클라우드에서 샤드를 호스팅하고 확장한다.

---

### 애플리케이션 복잡성

대부분의 DBMS에는 샤딩 기능이 내장되어 있지 않다.

따라서 DB 설계자와 소프트웨어 개발자가 DB를 수동으로 분할하고 분산하고 관리해야 한다.