## ✂️ DB 파티셔닝이란?

### 파티셔닝의 배경

---

서비스 규모가 커지며 DB에 저장되는 데이터 양도 기하급수적으로 증가하게 되었고,

이로 인해 기존에 사용하는 DB 시스템의 용량의 한계와 성능의 저하를 가져오게 되었다.

- 하나의 DBMS에 너무 큰 테이블을 다루면서 용량과 성능 측면에서 많은 이슈가 발생하게 되었다.

이를 해결하기 위한 방법으로 테이블을 **“파티션”**이라는 작은 단위로 나눠 관리하는 **“파티셔닝”** 기법이 나타났다.

- 파티셔닝을 통해 DB를 분산 처리함으로써 성능 저하를 방지하고, 관리의 효율성을 높일 수 있다.

### 파티셔닝의 개념

---

파티셔닝은 논리적인 데이터를 여러 엔티티로 세분화하는 과정을 의미한다.

즉, 큰 테이블이나 인덱스를 관리하기 쉬운 “파티션"이라는 작은 단위로 물리적 분할을 하는 것을 의미한다.

- 물리적 테이블 분할을 해도, DB에 접근하는 애플리케이션 입장에서는 이를 인식하지 못한다.

### 파티셔닝의 목적

---

1. **성능 향상**
    - 큰 테이블을 조회할 때, 데이터 접근 범위를 좁혀, 검색 성능을 개선한다.
    - INSERT가 빈번한 OLTP 시스템에서, INSERT 작업을 파티션별로 분산시켜 경합을 줄인다.
2. **가용성 향상**
    - 파티션을 물리적으로 분할함으로써 데이터 손상 가능성이 감소하고, 데이터 가용성이 증가한다.
    - 각 파티션은 독립적으로 백업 및 복구가 가능하다.
    - 파티션별로 디스크 I/O를 분산시켜 UPDATE 성능을 개선한다.
3. **관리 용이성**
    - 대규모 테이블을 파티션으로 분할함으로써 더 쉽게 데이터를 관리할 수 있다.

## 🔎 DB 파티셔닝의 장단점

### 파티셔닝의 장점

---

DB 파티셔닝은 데이터를 효율적으로 관리하고 성능을 개선하는 데 중요한 역할을 한다.

**[ 관리적 측면 ]**

- **데이터 가용성 향상**:
    - 파티션 단위로 데이터를 백업 및 복구할 수 있어, 전체 데이터 손실 위험이 감소한다.
- **성능 개선**:
    - 파티션 단위로 I/O를 분산시키므로, 특히 UPDATE 작업 시 성능이 개선된다.

**[ 성능적 측면 ]**

- 파티션 단위로 테이블을 조회하고 DML 작업을 수행함으로써, 필요한 데이터만 빠르게 접근하여 전체적인 데이터 처리 속도를 높일 수 있다.

### 파티셔닝의 단점

---

반면, 파티셔닝은 관리와 성능 면에서 여러 이점을 제공하지만 다음과 같은 단점을 가지고 있다.

**[ JOIN 비용 증가 ]**

- 파티셔닝된 테이블 간 JOIN 작업을 수행할 때, 비용이 증가하게 되어 성능 저하를 일으킬 수 있다.

**[ 테이블과 인덱스의 동시 파티셔닝 필요 ]**

- 테이블과 인덱스를 동시에 파티셔닝해야 하며, 이로 인해 테이블과 인덱스를 따로 다루는 것이 불가능하다.
    - 따라서 관리의 복잡성을 증가시킬 수 있다.

## 🗂️ DB 파티셔닝의 종류

### 1. 수평 파티셔닝

---

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/320192e3-8389-49c2-809f-23ce647c731b/Untitled.png)

---

수평 파티셔닝은 하나의 테이블의 각 행을 다른 테이블로 분산시키는 것이다.

수평 파티셔닝의 개념:

- 스키마를 복제한 후, 샤드 키를 기준으로 데이터를 나누는 것을 의미한다.

즉, 스키마가 같은 데이터를 두 개 이상의 테이블에 나눠서 저장하는 것을 의미한다.

수평 파티셔닝의 특징:

- 퍼포먼스, 가용성을 위해 KEY 기반으로 여러 곳에 분산 저장한다.
- 일반적으로 분산 저장 기술에서 파티셔닝은 수평 분할을 의미한다.
- 수평 분할이 이루어졌을 때, 하나의 데이터베이스 안에서 이루어지는 경우를 지칭한다.

수평 파티셔닝의 장점:

- 데이터 개수를 기준으로 나누어 파티셔닝하기 때문에,
- 데이터 개수가 작아지고 따라서 인덱스 개수도 작아지게 되면서 성능이 향상된다.

수평 파티셔닝의 단점:

- 서버 간 연결 과정이 많아진다.
- 데이터를 찾는 과정이 기존보다 복잡하기 때문에 지연 시간이 증가하게 된다.
- 하나의 서버가 고장나게 되면 데이터 무결성이 깨질 수 있다.

### 2. 수직 파티셔닝

---

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/d668431b-a714-40f7-a0e2-219f3f474bfd/Untitled.png)

---

수직 파티셔닝은 테이블의 일부 열을 빼내는 형태로 분할한다.

수직 파티셔닝의 개념:

- 모든 컬럼들 중 특정 컬럼들을 쪼개서 따로 저장하는 형태를 의미한다.
- 스키마를 나누고 데이터가 따라 옮겨가는 것을 의미한다.

즉, 하나의 엔티티를 2개 이상으로 분리하는 작업이다.

수직 파티셔닝의 특징:

- 관계형 DB에서 제 3정규형과 같은 개념과 비슷하다.
- 하지만 수직 파티셔닝은 이미 정규화된 테이블을 분리하는 과정이다.

수직 파티셔닝의 장점:

- 자주 사용하는 컬럼 등을 분리시켜 성능을 향상시킬 수 있다.
- 같은 타입의 데이터가 저장되기 때문에 저장 시 데이터 압축률을 높일 수 있다.
- 조회 시 필요 없는 컬럼을 조회하지 않아도 되므로 성능상 이점이 있다.

수직 파티셔닝의 단점:

- 데이터를 찾는 과정이 기존보다 복잡하므로 지연 시간이 증가한다.

## 📁 DB 파티셔닝의 분할 기준

---

데이터베이스 관리 시스템은 분할에 대해 각종 기준(분할 기법)을 제공하고 있다.

- 분할은 분할 키(partitioning key)를 사용한다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c33fee58-8f40-4523-b222-c56099de30a9/a2d9d961-ba24-46bf-87f3-b3e9bc61a78d/Untitled.png)

### 1. 범위 분할

---

- 연속적인 숫자나 날짜를 기준으로 파티셔닝한다.
- 분할 키 값이 범위 내에 있는지 여부로 구분한다.
- 예를 들어, 우편 번호나 날짜를 분할 키로 수평 분할하는 경우이다.

### 2. 목록 분할

---

- 값 목록에 파티션을 할당 분할 키 값을 그 목록에 비추어 파티션을 선택한다.
- 특정 파티시녀에 저장될 데이터에 대한 명시적인 제어가 가능하다.
- 분포도가 비슷하며, 많은 SQL에서 해당 컬럼의 조건이 많이 들어오는 경우에 유용하다.

### 3. 해시 분할

---

- 파티션 키의 해시 값에 의한 파티셔닝이 이루어진다.
- 균등한 데이터 분할이 가능하다.
- 특정 데이터가 어느 해시 파티션에 있는지 판단하기 어렵다.
- 해시 함수의 값에 따라 파티션에 포함할지 여부를 결정한다.
- 파티션을 위한 범위가 없는 데이터에 적합하다.

### 4. 합성 분할

---

- 상기 기술을 결합하는 것을 의미한다. 즉, 파티션의 서브-파티셔닝을 의미한다.
- 큰 파티션에 대한 I/O 요청을 여러 파티션으로 분산할 수 있다.
- 예를 들어, 먼저 범위를 분할하고 다음에 해시 분할을 할 수 있다.