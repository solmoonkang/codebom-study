## 효과적인 쿼리 저장이란?

---

데이터베이스에서 효과적인 쿼리 저장이란 말그대로,

- 데이터베이스에 저장된 **데이터를 검색, 조회 또는 처리할 때 성능을 최적화**하고,
- **자원 사용을 최소화**하기 위해 쿼리를 효율적으로 작성하고 관리하는 것을 말한다.

이를 통해 응답 시간을 단축하고, 데이터베이스 **서버의 부하를 줄일 수 있다.**

## ⁉️ 효과적인 쿼리 저장이 필요한 이유

---

효과적인 쿼리 저장은 다음과 같은 이유들로 인해 필요하다:

- **데이터베이스 성능과 안정성 최적화**:
    - 잘 구성된 쿼리는 데이터 검색, 삽입, 수정, 삭제를 효율적으로 수행해 DB의 **성능**을 크게 **향상**시킨다.
    - 이는 시스템의 전체적인 반응 시간과 처리 능력을 개선한다.

- **시스템 운영 비용 절감**:
    - 효율적인 쿼리는 DB 서버의 CPU 사용량, 메모리 사용량, 디스크 I/O를 최소화해 **리소스**를 **절약**한다.
    - 이는 특히 대규모 시스템에서 비용 절감 효과가 크다.

- **시스템 확장성 향상**:
    - 데이터베이스가 성장하고 사용자 수가 증가해도, 성능 저하 없이 서비스를 **지속적**으로 **제공**할 수 있다.

- **유지보수 용이성**:
    - 잘 설계된 쿼리는 코드의 가독성을 높이고, **유지보수**를 **용이**하게 한다.
    - 이는 향후 시스템 수정이나 업그레이드 시 시간과 노력을 절약할 수 있다.

- **데이터 무결성 유지**:
    - 정확성을 보장하고 데이터 중복을 방지하는 쿼리는 **데이터의 무결성** 유지에 중요하다.
    - 무결성이 보장되면, 신뢰할 수 있는 데이터 분석 및 의사 결정이 가능해진다.

- **데이터 보안 강화**:
    - 쿼리를 통한 데이터 접근 제어는 민감한 정보의 무단 접근 방지와 **데이터 보안** 강화에 기여한다.
    - SQL 인젝션 같은 공격으로부터 시스템을 보호하는 것도 중요하다.

## 효과적인 쿼리 저장을 위한 전략

### 1. 인덱싱 활용

---

**인덱싱 활용 전략**: 자주 조회되는 컬럼에 인덱스를 생성하여 검색 속도를 향상시킨다.

- **주의점**: 무분별한 인덱스 사용은 삽입, 수정, 삭제 작업의 성능을 저하시킬 수 있다.

WHERE, JOIN, ORDER BY절에서 자주 사용되는 컬럼에 인덱스를 추가해 쿼리 실행 속도를 향상시킬 수 있다.

예를 들어, 고객 DB에서 고객의 이메일 주소로 자주 검색을 한다면, 이메일 컬럼에 인덱스를 추가할 수 있다.

### 2. 쿼리 최적화

---

**쿼리 최적화 전략**:

1. 불필요한 조인을 피하고 적절한 JOIN 방법을 선택하여 쿼리의 실행 속도를 향상시킬 수 있다.
   - JOIN을 할 때 작은 테이블을 기준으로 잡거나,
   - JOIN 대상 테이블에 인덱스가 생성되어 있을 경우 성능을 향상시킬 수 있다.

```sql
SELECT *;
```

---

위 코드처럼 모든 대상을 조회하는 것이 아닌, 다음과 같이 필요한 데이터만 JOIN해서 조회한다.

```sql
SELECT * FROM orders JOIN customers ON orders.customer_id = customers.id
```

2. 서브쿼리는 복잡한 쿼리를 만들 때 도움이 되지만, 대개 실행 속도가 느리다.
   - 서브쿼리 사용을 줄이고, JOIN 등의 방법으로 대체하여 쿼리 성능을 향상시킬 수 있다.

```sql
SELECT * 
FROM orders 
WHERE customer_id IN (SELECT id FROM customers WHERE country = 'KR')
```

---

위 코드의 서브쿼리 대신 다음과 같이 JOIN 사용으로 대체할 수 있다.

```sql
SELECT orders.* 
FROM orders 
JOIN customers ON orders.customer_id = customers.id 
WHERE customers.country = 'KR'
```

3. 데이터 조회 시 불필요한 컬럼을 선택하지 않고, 필요한 데이터만 조회하도록 쿼리를 작성한다.

4. UNION 대신 UNION ALL을 사용하여 성능을 향상시킬 수 있다.
   - UNION은 중복된 결과를 제거하므로 데이터 정렬 과정이 필요해 성능 저하가 일어날 수 있다.
   - 반면, UNION ALL은 중복 결과가 없기 때문에 성능을 향상시킬 수 있다.

### 3. 캐싱 사용

---

**캐싱 사용 전략**: 자주 사용되는 쿼리 결과를 캐시에 저장하여, 같은 요청이 있을 때 빠르게 응답할 수 있도록 한다.

- 이는 데이터베이스의 부하를 줄이고, 응답 시간을 단축하는 데 도움이 된다.

예를 들어, 사용자의 로그인 정보 조회 쿼리 결과를 캐시하여,

같은 사용자가 로그인할 때마다 데이터베이스에 쿼리를 날리지 않고 캐시에서 빠르게 결과를 가져올 수 있다.

### 4. 배치 처리

---

**배치 처리 전략**: 대량의 데이터 처리 시, 쿼리를 여러 작은 단위로 나누어 순차적 또는 병렬로 처리할 수 있다.

- 이는 서버의 부하를 분산시키고, 전체 처리 시간을 단축시킬 수 있다.

예를 들어, 매일 밤 대량의 로그 데이터를 처리할 때, 데이터를 시간별로 나누어서 순차적으로 처리한다.

### 5. 실행 계획 분석

---

**실행 계획 분석 전략**: DBMS에서 제공하는 실행 계획 분석 도구를 이용해 쿼리의 실행 계획을 확인하고,

비효율적인 부분을 개선한다.

예를 들어, 해당 쿼리가 전체 테이블 스캔을 하지 않고 인덱스를 활용하여 처리하고 있는지 확인한다.

```sql
EXPLAIN SELECT * FROM orders WHERE customer_id = 123
```