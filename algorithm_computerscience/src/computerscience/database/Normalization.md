# 정규화 *(1차, 2차, 3차, BCNF)*

---

정규형에는 ***제1 정규형, 제2 정규형, 제3 정규형, BCNF***, *제4 정규형, 제5 정규형* 등이 있다.

- 일반적으로 데이터베이스를 설계할 때 3NF 또는 BCNF 까지만 고려한다.

정규화의 기본적인 목표는 ***테이블 간 중복된 데이터를 허용하도록 하지 않는 것*** 이다.

- 중복된 데이터를 허용하지 않음으로 ***“무결성”*** 을 유지할 수 있고, DB의 저장 용량을 줄일 수 있다.
- 따라서 정규화란 중복된 데이터를 허용하지 않도록 테이블을 분해하는 과정이다.

## *제1 정규형, 1NF*

---

제1 정규형을 만족할 필요 충분 조건은 ***릴레이션 R의 모든 애트리뷰트가 원자값만을 갖는다*** 는 것이다.

- 즉, 릴레이션의 모든 애트리뷰트에 ***“반복 그룹”*** 이 나타나지 않으면 제1 정규형을 만족한다.
    - ***“반복 그룹”*** 이란 한 개의 기본 키값에 두 개 이상의 값을 갖을 수 있는 애트리뷰트를 의미한다.

예를 들어서 설명하면 다음과 같다. 아래는 반복 그룹에 대한 학생 릴레이션이다.

| 학번 | 이름 | 과목번호 | 주소 |
| --- | --- | --- | --- |
| 11002 | 이홍근 | { CS310, CS313 } | 우이동 |
| 24036 | 김순미 | { CS310, CS345 } | 양재동 |

---

위의 학생 릴레이션에서 과목번호 애트리뷰트는 각 학생이 수강하는 여러 과목들의 집합값을 갖고 있다.

- ⚠️ 따라서 위 학생 릴레이션은 제1 정규형을 만족하지 못한다.

위의 릴레이션을 제1 정규형으로 변환하는 방법은 두 가지가 존재한다.

- 하나는 반복 그룹 애트리뷰트에 나타나는 집합에 속한 각 값마다 하나의 투플로 표현하는 것이다.
- 다른 하나는 두 릴레이션으로 분해하는 것이다.

**[ 애트리뷰트에 원자값만 있는 릴레이션 ]**

| 학번 | 이름 | 과목번호 | 주소 |
| --- | --- | --- | --- |
| 11002 | 이홍근 | CS310 | 우이동 |
| 11002 | 이홍근 | CS313 | 우이동 |
| 24036 | 김순미 | CS345 | 양재동 |
| 24036 | 김순미 | CS310 | 양재동 |

---

위와 같이 하나의 투플로 표현하는 방법을 적용하면, 제1 정규형을 만족하는 릴레이션으로 변환할 수 있다.

- 단, **정보가 많이 중복**되므로 **갱신 이상을 유발**한다.

**[ 두 릴레이션으로 분해 ]**

| 학번 | 이름 | 주소 |
| --- | --- | --- |
| 11002 | 이홍근 | 우이동 |
| 24036 | 김순미 | 양재동 |

| 학번 | 과목번호 |
| --- | --- |
| 11002 | CS310 |
| 11002 | CS313 |
| 24036 | CS345 |
| 24036 | CS310 |

---

위와 같이 모든 반복 그룹 애트리뷰트들을 분리해서 새로운 릴레이션에 넣어 제1 정규형을 만족할 수 있다.

- 여기서는 기존 릴레이션의 기본 키를 새로운 릴레이션에 애트리뷰트로 추가한다.
- 단, 기존 릴레이션의 기본 키가 새로운 릴레이션에서도 항상 키가 되는 것은 아니다.

## *제2 정규형, 2NF*

---

제2 정규형은 제1 정규화를 만족한 테이블에서 ***“부분 함수 족속성”*** 을 제거하는 과정이다.

👇 아래에 있는 릴레이션은 모든 애트리뷰트가 원자값을 가지므로 제1 정규형을 만족하는 릴레이션이다.

**[ 제1 정규형을 만족하는 릴레이션 ]**

| 학번 | 학과이름 | 학과전화번호 | 과목번호 | 학점 |
| --- | --- | --- | --- | --- |
| 11002 | 컴퓨터공학 | 210-2261 | CS310 | A |
| 11002 | 컴퓨터공학 | 210-2261 | CS313 | B |
| 24036 | 정보통신 | 210-2585 | IC214 | B+ |

---

위의 릴레이션은 다음과 같은 상태 이상을 유발할 수 있다.

- ***⚠️ 수정 이상***:
    - 한 학과에 소속된 학생 수만큼 학과의 전화번호가 중복되어 전화번호가 변경될 때,
    - 학과에 속한 모든 학생의 전화번호를 수정하지 않으면 데이터베이스의 **일관성이 유지되지 않는다.**
- ***⚠️ 삽입 이상***:
    - 한 명의 학생이라도 어떤 학과에 소속되지 않으면 학과에 관련된 투플을 삽입할 수 없다.
    - 학번은 기본 키의 구성요소인데 ***“엔티티 무결성 제약조건”***에 따라 기본 키는 *null* 을 입력할 수 없다.
- ***⚠️ 삭제 이상***:
    - 어떤 학과에 소속된 마지막 학생 투플을 삭제하면, 해당 학생이 소속된 학과 관련 정보도 삭제된다.
    - 예를 들어, 정보통신학과에는 한 명의 학생만 존재하는데,
        - 해당 학생의 투플을 삭제하면 정보통신학과에 관한 정보 또한 함께 삭제된다.

이와 같은 갱신 이상이 생기는 이유는 기본 키에 대한 ***“부분 함수적 종속성”*** 이 릴레이션에 존재하기 때문이다.

따라서, 위의 릴레이션을 학생 릴레이션과 수강 릴레이션으로 나누면 부분 함수적 종속성이 없어지게 된다.

**[ 부분 함수적 종속성이 존재하지 않도록 분해된 두 릴레이션 ]**

| 학번 | 학과이름 | 학과전화번호 |
| --- | --- | --- |
| 11002 | 컴퓨터공학 | 210-2261 |
| 11002 | 컴퓨터공학 | 210-2261 |
| 24036 | 정보통신 | 210-2585 |

| 학번 | 과목번호 | 학점 |
| --- | --- | --- |
| 11002 | CS310 | A |
| 11002 | CS313 | B |
| 24036 | IC214 | B+ |

---

두 릴레이션으로 분해 시, 기존 릴레이션에서 기본 키에 부분 종속되는 애트리뷰트는 한 릴레이션에 속하게 한다.

- 기본 키에 부분 종속되는 애트리뷰트인 학과이름과 학과전화번호들은 학생 릴레이션에 속하도록 한다.
- 해당 애트리뷰트들이 부분적으로 종속됐던 애트리뷰트인 학번이 학생 릴레이션의 기본 키가 된다.

그리고 기존 릴레이션의 나머지 애트리뷰드들은 또 다른 릴레이션인 수강 릴레이션에 포함되도록 한다.

- 학번 애트리뷰트를 외래 키로 수강 릴레이션에 포함시킨다.

따라서 학생 릴레이션의 기본 키는 하나의 애트리뷰트로 이루어지므로 제2 정규형을 만족한다.

수강 릴레이션의 경우 기본 키는 복합 애트리뷰트인 (학번, 과목번호)이지만, 학점 애트리뷰트가 기본 키에 완전하게 함수적으로 종속하므로 제2 정규형을 만족한다.

### 제2 정규형의 정의

---

제2 정규형은 한 릴레이션이 제1 정규형을 만족하면서,

어떤 후보 키에도 속하지 않는 모든 애트리뷰트들이 기본 키에 완전하게 함수적으로 종속하는 것을 의미한다.

- 기본 키가 두 개 이상의 애트리뷰트일 경우, 제1 정규형과 제2 정규형을 만족하는지 고려할 필요가 있다.
- *즉, 기본 키가 한 개의 애트리뷰트로 이루어진 릴레이션이 제1 정규형을 만족하면 제2 정규형도 만족한다.*

## *제3 정규형, 3NF*

---

제3 정규형은 제2 정규화를 만족한 테이블에서 ***“이행적 함수 종속성”*** 을 제거하는 과정이다.

- ***“이행적 함수 종속성”*** 이란 A → B 종속, B → C 종속, A → C 종속인 관계를 의미한다.

👇 아래에 있는 릴레이션은 기본 키가 한 애트리뷰트인 학번이므로 제2 정규형을 만족하는 릴레이션이다.

**[ 제2 정규형을 만족하는 릴레이션 ]**

| 학번 | 학과이름 | 학과전화번호 |
| --- | --- | --- |
| 11002 | 컴퓨터공학 | 210-2261 |
| 11002 | 컴퓨터공학 | 210-2261 |
| 24036 | 정보통신 | 210-2585 |

---

위의 릴레이션은 다음과 같은 상태 이상을 유발할 수 있다.

- ***⚠️ 수정 이상***:
    - 여러 학생이 소속된 학과의 전화번호가 변경되었을 때,
    - 해당 학과에 속한 모든 학생들의 투플에서 전화번호를 수정하지 않으면 **일관성이 유지되지 않는다**.
- ***⚠️ 삽입 이상***:
    - 어떤 학과를 신설해서 아직 소속 학생이 없으면, 해당 학과의 정보를 입력할 수 없다.
    - 학번이 기본 키이므로 ***“엔티티 무결성 제약조건”*** 에 따라 기본 키에 *null* 값을 입력할 수 없다.
- ***⚠️ 삭제 이상***:
    - 어떤 학과에서 마지막 학생의 투플이 삭제되면, 해당 학과의 전화번호도 함께 삭제된다.

이와 같은 갱신 이상이 생기는 이유는 ***“이행적 종속성”*** 이 릴레이션에 존재하기 때문이다.

- 즉, 키가 아닌 애트리뷰트에 하나 이상의 애트리뷰트가 함수적으로 종속할 수 있다.
    - 위의 릴레이션에서 학과이름과 학과전화번호는 기본 키인 학번에 함수적으로 종속하고,
    - 학과전화번호는 학과이름에도 함수적으로 종속한다.
    - *학번 → 학과이름* *^* *학과이름 → 학과전화번호* = *학번 → 학과전화번호*

따라서, 위의 릴레이션을 학번&학과이름과 학과이름&학과전화번호로 나누면 이해 종속성이 없어지게 된다.

**[ 이행적 종속성이 존재하지 않도록 분해된 두 릴레이션 ]**

| 학번 | 학과이름 |
| --- | --- |
| 11002 | 컴퓨터공학 |
| 11002 | 컴퓨터공학 |
| 24036 | 정보통신 |

| 학과이름 | 학과전화번호 |
| --- | --- |
| 컴퓨터공학 | 210-2261 |
| 컴퓨터공학 | 210-2261 |
| 정보통신 | 210-2585 |

---

두 릴레이션으로 분해할 때, 하나는

- 기존 릴레이션의 나머지 애트리뷰트들을 속하도록 한다.
- 그리고 학과이름 애트리뷰트를 외래 키로 릴레이션에 포함시킨다.

또 다른 하나는

- 원래 릴레이션에서 기본 키가 아닌 애트리뷰트에 종속되는 애트리뷰트인 학과전화번호,
- 키가 아니면서 다른 애트리뷰트를 결정하는 애트리뷰트인 학과이름을 새로운 릴레이션에 속하도록 한다.

### 제3 정규형의 정의

---

제3 정규형은 한 릴레이션이 제2 정규형을 만족하면서,

**키가 아닌 모든 애트리뷰트가 릴레이션의 기본 키에 이행적으로 종속하지 않는** 것을 의미한다.

## *BCNF*

---

BCNF 를 만족하는 릴레이션은 갱신 이상이 발생하지 않는 **실제적인 정규화의 목표**이다.

- 즉, BCNF 를 만족하는 릴레이션에서는 중복이 존재하지 않고, 갱신 이상도 발생하지 않는다.

👇 아래 릴레이션은 각 학생은 여러 과목을 수강할 수 있고, 각 강사는 하나의 과목만 가르친다.

**[ 제3 정규형을 만족하는 릴레이션 ]**

| 학번 | 과목 | 강사 |
| --- | --- | --- |
| 11002 | 데이터베이스 | 이영준 |
| 11002 | 운영체제 | 고성현 |
| 24036 | 자료구조 | 엄영지 |
| 24036 | 데이터베이스 | 조민형 |
| 11048 | 데이터베이스 | 이영준 |

---

위의 릴레이션에는 함수적 종속성들이 존재하므로 다음과 같은 갱신 이상을 일으킬 수 있다.

- 위 릴레이션에서는 강사 애트리뷰트는 키가 아니지만, 결정자가 되므로 문제를 야기시킬 수 있다.

- ***⚠️ 수정 이상***:
    - 여러 학생이 수강 중인 어떤 과목의 강사가 변경되었을 때,
    - 해당 과목을 수강하는 모든 학생들의 투플에서 강사를 수정하지 않으면 **일관성이 유지되지 않는다**.
- ***⚠️ 삽입 이상***:
    - 어떤 과목을 신설하여 아직 수강하는 학생이 없으면, 어떤 강사가 과목을 가르치는지 입력할 수 없다.
    - 위 릴레이션에서는 학번이 기본 키인데, ***“엔티티 무결성 제약조건”*** 을 따라 *null* 값을 입력할 수 없다.
- ***⚠️ 삭제 이상***:
    - 어떤 과목을 이수하는 학생이 한 명밖에 없는데,
    - 해당 학생의 투플을 삭제하면 해당 과목을 가르치는 강사에 관한 정보 또한 함께 삭제된다.

위와 같은 갱신 이상이 발생하는 이유는 키가 아닌 애트리뷰트가 다른 애트리뷰트를 결정하기 때문이다.

- 위의 릴레이션의 후보 키는 (학번, 과목)과 (학번, 강사)이다.

### BCNF의 정의

---

BCNF는 한 릴레이션이 제3 정규형을 만족하고, **모든 결정자가 후보 키이어야 한다는 것**을 의미한다.

대부분의 릴레이션들은 제3 정규형을 만족하면 BCNF 또한 만족한다.

그러나 그렇지 않은 경우도 존재하는데, 다음은 키가 아닌 애트리뷰트가 키 애트리뷰트의 결정자인 경우이다.

- 아래 릴레이션에서는 강사 애트리뷰트가 후보 키가 아님에도 과목 애트리뷰트를 결정하기 때문이다.

**[ 제3 정규형을 만족하지만 BCNF는 만족하지 않는 릴레이션 ]**

| 학번 | 과목 | 강사 |
| --- | --- | --- |
| 11002 | 데이터베이스 | 이영준 |
| 11002 | 운영체제 | 고성현 |
| 24036 | 자료구조 | 엄영지 |
| 24036 | 데이터베이스 | 조민형 |
| 11048 | 데이터베이스 | 이영준 |

**[ 제3 정규형을 BCNF로 정규화한 릴레이션 ]**

| 학번 | 강사 |
| --- | --- |
| 11002 | 이영준 |
| 11002 | 고성현 |
| 24036 | 엄영지 |
| 24036 | 조민형 |
| 11048 | 이영준 |

| 강사  | 과목 |
| --- | --- |
| 이영준 | 데이터베이스 |
| 고성현 | 운영체제 |
| 엄영지 | 자료구조 |
| 조민형 | 데이터베이스 |
| 이영준 | 데이터베이스 |

---

위 릴레이션을 BCNF로 정규화하려면,

키가 아니면서 결정자 역할을 하는 애트리뷰트와 그 결정자에 함수적 종속하는 애트리뷰트를 릴레이션에 넣는다.

- 그렇게 하게 되면, 해당 릴레이션에서의 결정자는 기본 키가 된다.

그 다음에는 기존 릴레이션에 결정자(강사)를 남겨서 기본 키의 구성 요소가 되도록 한다.

- 해당 결정자는 새로운 릴레이션에 대한 외래 키 역할도 하게 된다.

## ⁉️ 면접 예상 질문: 정규화와 비정규화

### 정규화와 비정규화는 무엇이고, 어떤 장점과 단점을 갖을까요?

---

정규화는 데이터 무결성을 유지하기 위해 테이블을 분해하여 중복 데이터를 제거하는 방식이다.

- 즉, 관계형 데이터베이스에서 중복을 최소화하기 위해 데이터를 구조화하는 작업 방식이다.

비정규화는 정규화와 반대로 테이블에 중복 데이터를 추가하는 방식이다.

- 복잡한 쿼리 속도를 높이고, 속도를 향상시키기 위해 테이블에 중복 데이터를 추가하는 방식이다.

정규화는 다음과 같은 장점과 단점을 갖는다.

- 정규화는 DB 변경 시 이상 현상을 제거하고, DB 구조 확장 시 재디자인을 최소화한다.
- 반대로, 릴레이션 분해로 인해 릴레이션 간 연산이 많아져서 응답 시간이 느려질 수 있다.